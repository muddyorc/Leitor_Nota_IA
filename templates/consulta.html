<!-- templates/consulta.html -->
<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Consulta RAG</title>
  </head>
  <body>
    <h1>Consulta Analítica (RAG)</h1>
    <form id="consultaForm">
      <label for="modo">Modo de busca:</label>
      <select id="modo" name="modo">
        <option value="simples">RAG Simples (SQL)</option>
        <option value="semantico">RAG Semântico (Embeddings)</option>
      </select>
      <br/><br/>
      <textarea id="pergunta" name="pergunta" rows="6" cols="80" placeholder="Digite sua pergunta..."></textarea>
      <br/>
      <button type="submit">Consultar</button>
    </form>

    <h2>Resposta</h2>
    <div id="resposta" style="white-space:pre-wrap; border:1px solid #ccc; padding:10px; min-height:120px;">
      Nenhuma consulta realizada ainda.
    </div>

    <script>
      const form = document.getElementById('consultaForm');
      const respostaDiv = document.getElementById('resposta');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        respostaDiv.textContent = "Processando...";
        const modo = document.getElementById('modo').value;
        const pergunta = document.getElementById('pergunta').value;
        try {
          const r = await fetch('/consultar_rag', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({modo, pergunta})
          });
          const data = await r.json();
          if (!r.ok) {
            respostaDiv.textContent = JSON.stringify(data, null, 2);
            return;
          }
          respostaDiv.textContent = data.resposta || JSON.stringify(data, null, 2);
        } catch (err) {
          respostaDiv.textContent = 'Erro: ' + err.message;
        }
      });
    </script>
  </body>
</html>
